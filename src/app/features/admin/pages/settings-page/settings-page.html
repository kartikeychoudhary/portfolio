<div class="flex min-h-screen bg-gray-100 dark:bg-gray-900">
  <!-- Sidebar -->
  <app-admin-sidebar></app-admin-sidebar>

  <!-- Main Content -->
  <main class="flex-1 overflow-y-auto">
    <app-password-warning-banner></app-password-warning-banner>
    <div class="p-6 lg:p-8">
      <!-- Page Header -->
      <div class="mb-8">
        <h1 class="text-2xl font-bold text-gray-800 dark:text-white">
          <i class="fa-solid fa-gear mr-2"></i>Settings
        </h1>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Manage your account and customize the portfolio appearance.
        </p>
      </div>

      <app-loading-spinner *ngIf="settingsLoading"></app-loading-spinner>

      <div *ngIf="!settingsLoading" class="grid grid-cols-1 lg:grid-cols-2 gap-6">

        <!-- ═══════════════════════════════════════════════════ -->
        <!-- CHANGE PASSWORD CARD                                 -->
        <!-- ═══════════════════════════════════════════════════ -->
        <div
          class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6"
          [class.ring-2]="requiresPasswordChange"
          [class.ring-amber-400]="requiresPasswordChange"
        >
          <div class="flex items-center gap-3 mb-5">
            <div class="w-10 h-10 rounded-lg bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
              <i class="fa-solid fa-lock text-red-600 dark:text-red-400"></i>
            </div>
            <div>
              <h2 class="text-base font-semibold text-gray-800 dark:text-white">Change Password</h2>
              <p class="text-xs text-gray-500 dark:text-gray-400">Update your account password</p>
            </div>
          </div>

          <!-- Alert banner for first login -->
          <div *ngIf="requiresPasswordChange" class="mb-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md">
            <div class="flex items-center">
              <i class="fa-solid fa-triangle-exclamation text-amber-600 dark:text-amber-400 mr-2"></i>
              <p class="text-sm text-amber-800 dark:text-amber-200">Please change your password before continuing.</p>
            </div>
          </div>

          <!-- Success Message -->
          <div *ngIf="successMessage && !requiresPasswordChange" class="mb-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md">
            <div class="flex items-center">
              <i class="fa-solid fa-circle-check text-green-600 dark:text-green-400 mr-2"></i>
              <p class="text-sm text-green-800 dark:text-green-200">{{ successMessage }}</p>
            </div>
          </div>

          <!-- Error Message -->
          <div *ngIf="errorMessage" class="mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md">
            <div class="flex items-center">
              <i class="fa-solid fa-circle-exclamation text-red-600 dark:text-red-400 mr-2"></i>
              <p class="text-sm text-red-800 dark:text-red-200">{{ errorMessage }}</p>
            </div>
          </div>

          <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-4">
            <!-- Current Password -->
            <div class="flex flex-col gap-1">
              <label for="currentPassword" class="text-sm font-medium text-gray-700 dark:text-gray-300">Current Password</label>
              <div class="relative">
                <input
                  [type]="showCurrentPassword ? 'text' : 'password'"
                  id="currentPassword"
                  formControlName="currentPassword"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white pr-10"
                  [class.border-red-500]="currentPassword?.invalid && currentPassword?.touched"
                />
                <button type="button" (click)="togglePasswordVisibility('current')" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400">
                  <i [class]="showCurrentPassword ? 'fa-solid fa-eye-slash' : 'fa-solid fa-eye'"></i>
                </button>
              </div>
              <small *ngIf="currentPassword?.invalid && currentPassword?.touched" class="text-red-500 dark:text-red-400 text-xs">Current password is required</small>
            </div>

            <!-- New Password -->
            <div class="flex flex-col gap-1">
              <label for="newPassword" class="text-sm font-medium text-gray-700 dark:text-gray-300">New Password</label>
              <div class="relative">
                <input
                  [type]="showNewPassword ? 'text' : 'password'"
                  id="newPassword"
                  formControlName="newPassword"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white pr-10"
                  [class.border-red-500]="newPassword?.invalid && newPassword?.touched"
                />
                <button type="button" (click)="togglePasswordVisibility('new')" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400">
                  <i [class]="showNewPassword ? 'fa-solid fa-eye-slash' : 'fa-solid fa-eye'"></i>
                </button>
              </div>
              <div *ngIf="newPassword?.invalid && newPassword?.touched" class="text-red-500 dark:text-red-400 text-xs">
                <span *ngIf="newPassword?.errors?.['required']">New password is required</span>
                <span *ngIf="newPassword?.errors?.['minlength']">Password must be at least 8 characters</span>
                <span *ngIf="newPassword?.errors?.['passwordStrength']">Must contain uppercase, lowercase, and digit</span>
              </div>
            </div>

            <!-- Confirm Password -->
            <div class="flex flex-col gap-1">
              <label for="confirmPassword" class="text-sm font-medium text-gray-700 dark:text-gray-300">Confirm New Password</label>
              <div class="relative">
                <input
                  [type]="showConfirmPassword ? 'text' : 'password'"
                  id="confirmPassword"
                  formControlName="confirmPassword"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white pr-10"
                  [class.border-red-500]="(confirmPassword?.invalid && confirmPassword?.touched) || (changePasswordForm.errors?.['passwordMismatch'] && confirmPassword?.touched)"
                />
                <button type="button" (click)="togglePasswordVisibility('confirm')" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400">
                  <i [class]="showConfirmPassword ? 'fa-solid fa-eye-slash' : 'fa-solid fa-eye'"></i>
                </button>
              </div>
              <div *ngIf="confirmPassword?.touched" class="text-red-500 dark:text-red-400 text-xs">
                <span *ngIf="confirmPassword?.errors?.['required']">Password confirmation is required</span>
                <span *ngIf="changePasswordForm.errors?.['passwordMismatch'] && !confirmPassword?.errors?.['required']">Passwords do not match</span>
              </div>
            </div>

            <div class="flex justify-end pt-2">
              <p-button
                type="submit"
                label="Change Password"
                icon="fa-solid fa-key"
                [disabled]="isSubmitting"
                [loading]="isSubmitting"
              ></p-button>
            </div>
          </form>
        </div>

        <!-- ═══════════════════════════════════════════════════ -->
        <!-- AVATAR SIZE CARD                                     -->
        <!-- ═══════════════════════════════════════════════════ -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6" [formGroup]="settingsForm">
          <div class="flex items-center gap-3 mb-5">
            <div class="w-10 h-10 rounded-lg bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center">
              <i class="fa-solid fa-user-circle text-indigo-600 dark:text-indigo-400"></i>
            </div>
            <div>
              <h2 class="text-base font-semibold text-gray-800 dark:text-white">Avatar Size</h2>
              <p class="text-xs text-gray-500 dark:text-gray-400">Control the hero section avatar dimensions</p>
            </div>
          </div>

          <p-selectButton
            [options]="avatarSizeOptions"
            formControlName="avatarSize"
            optionLabel="label"
            optionValue="value"
          ></p-selectButton>
        </div>

        <!-- ═══════════════════════════════════════════════════ -->
        <!-- ACCENT COLOR CARD                                    -->
        <!-- ═══════════════════════════════════════════════════ -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6" [formGroup]="settingsForm">
          <div class="flex items-center gap-3 mb-5">
            <div class="w-10 h-10 rounded-lg bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center">
              <i class="fa-solid fa-palette text-purple-600 dark:text-purple-400"></i>
            </div>
            <div>
              <h2 class="text-base font-semibold text-gray-800 dark:text-white">Accent Color</h2>
              <p class="text-xs text-gray-500 dark:text-gray-400">Set the primary color used throughout the portfolio</p>
            </div>
          </div>

          <!-- Preset swatches -->
          <div class="flex flex-wrap gap-3 mb-4">
            <button
              *ngFor="let preset of accentPresets"
              type="button"
              (click)="selectAccentPreset(preset.value)"
              [pTooltip]="preset.label"
              class="w-10 h-10 rounded-full border-2 transition-all hover:scale-110 cursor-pointer"
              [style.background-color]="preset.value"
              [class.border-gray-800]="isActivePreset(preset.value)"
              [class.dark\:border-white]="isActivePreset(preset.value)"
              [class.border-transparent]="!isActivePreset(preset.value)"
              [class.ring-2]="isActivePreset(preset.value)"
              [class.ring-offset-2]="isActivePreset(preset.value)"
              [class.ring-gray-400]="isActivePreset(preset.value)"
            >
              <i *ngIf="isActivePreset(preset.value)" class="fa-solid fa-check text-white text-xs"></i>
            </button>
          </div>

          <!-- Custom color picker -->
          <div class="flex items-center gap-3">
            <span class="text-sm text-gray-600 dark:text-gray-400">Custom:</span>
            <p-colorPicker
              [ngModel]="customAccentColor"
              [ngModelOptions]="{standalone: true}"
              (ngModelChange)="onCustomColorChange($event)"
            ></p-colorPicker>
            <span class="text-sm text-gray-500 dark:text-gray-400 font-mono">{{ settingsForm.get('accentColor')?.value }}</span>
          </div>
        </div>

        <!-- ═══════════════════════════════════════════════════ -->
        <!-- FONT FAMILY CARD                                     -->
        <!-- ═══════════════════════════════════════════════════ -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6" [formGroup]="settingsForm">
          <div class="flex items-center gap-3 mb-5">
            <div class="w-10 h-10 rounded-lg bg-teal-100 dark:bg-teal-900/30 flex items-center justify-center">
              <i class="fa-solid fa-font text-teal-600 dark:text-teal-400"></i>
            </div>
            <div>
              <h2 class="text-base font-semibold text-gray-800 dark:text-white">Font Family</h2>
              <p class="text-xs text-gray-500 dark:text-gray-400">Choose the typeface for the portfolio</p>
            </div>
          </div>

          <select
            formControlName="fontFamily"
            class="w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
          >
            <option *ngFor="let font of fontOptions" [value]="font.value">{{ font.label }}</option>
          </select>

          <!-- Font preview -->
          <div
            class="mt-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-md text-gray-700 dark:text-gray-300 text-sm"
            [style.font-family]="settingsForm.get('fontFamily')?.value + ', sans-serif'"
          >
            The quick brown fox jumps over the lazy dog. 0123456789
          </div>
        </div>

        <!-- ═══════════════════════════════════════════════════ -->
        <!-- SECTION VISIBILITY CARD                              -->
        <!-- ═══════════════════════════════════════════════════ -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 lg:col-span-2" [formGroup]="settingsForm">
          <div class="flex items-center gap-3 mb-5">
            <div class="w-10 h-10 rounded-lg bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center">
              <i class="fa-solid fa-eye text-amber-600 dark:text-amber-400"></i>
            </div>
            <div>
              <h2 class="text-base font-semibold text-gray-800 dark:text-white">Section Visibility</h2>
              <p class="text-xs text-gray-500 dark:text-gray-400">Toggle which sections appear on the public portfolio</p>
            </div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="flex items-center gap-2">
                <i class="fa-solid fa-rocket text-gray-500 dark:text-gray-400 w-5 text-center"></i>
                <span class="text-sm text-gray-700 dark:text-gray-300">Hero</span>
              </div>
              <p-toggleSwitch formControlName="heroVisible"></p-toggleSwitch>
            </div>

            <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="flex items-center gap-2">
                <i class="fa-solid fa-user text-gray-500 dark:text-gray-400 w-5 text-center"></i>
                <span class="text-sm text-gray-700 dark:text-gray-300">About</span>
              </div>
              <p-toggleSwitch formControlName="aboutVisible"></p-toggleSwitch>
            </div>

            <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="flex items-center gap-2">
                <i class="fa-solid fa-code text-gray-500 dark:text-gray-400 w-5 text-center"></i>
                <span class="text-sm text-gray-700 dark:text-gray-300">Skills</span>
              </div>
              <p-toggleSwitch formControlName="skillsVisible"></p-toggleSwitch>
            </div>

            <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="flex items-center gap-2">
                <i class="fa-solid fa-briefcase text-gray-500 dark:text-gray-400 w-5 text-center"></i>
                <span class="text-sm text-gray-700 dark:text-gray-300">Experience</span>
              </div>
              <p-toggleSwitch formControlName="experienceVisible"></p-toggleSwitch>
            </div>

            <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="flex items-center gap-2">
                <i class="fa-solid fa-diagram-project text-gray-500 dark:text-gray-400 w-5 text-center"></i>
                <span class="text-sm text-gray-700 dark:text-gray-300">Projects</span>
              </div>
              <p-toggleSwitch formControlName="projectsVisible"></p-toggleSwitch>
            </div>

            <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="flex items-center gap-2">
                <i class="fa-solid fa-envelope text-gray-500 dark:text-gray-400 w-5 text-center"></i>
                <span class="text-sm text-gray-700 dark:text-gray-300">Contact</span>
              </div>
              <p-toggleSwitch formControlName="contactVisible"></p-toggleSwitch>
            </div>
          </div>
        </div>

        <!-- ═══════════════════════════════════════════════════ -->
        <!-- SAVE SETTINGS BUTTON                                 -->
        <!-- ═══════════════════════════════════════════════════ -->
        <div class="lg:col-span-2 flex justify-end">
          <p-button
            label="Save Settings"
            icon="fa-solid fa-floppy-disk"
            (onClick)="saveSettings()"
            [disabled]="settingsSaving"
            [loading]="settingsSaving"
          ></p-button>
        </div>
      </div>
    </div>
  </main>
</div>
